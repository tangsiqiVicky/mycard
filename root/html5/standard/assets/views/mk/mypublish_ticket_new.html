<script src="assets/js/controllers/mk/MyPublishTicketNewCtrl.js"></script>

<!-- start: REGISTRATION class="main-login col-xs-10 col-xs-offset-1 col-sm-8 col-sm-offset-2 col-md-4 col-md-offset-4"-->
<div class="row">
    <div class="main-login col-xs-12" style="margin-top:0px;">

        <!-- start: REGISTER BOX -->
        <div class="box-register small" ng-controller="MyPublishTicketNewCtrl">


            <div id="asideContent3" style="display:none;border:1px solid #dddddd;background:#fff;" class="roundrec">
                <!--<script type="text/ng-template" id="asideContent.html">-->
                <div class="modal-header" style="height:60px;">

                    <div class="col-xs-12">

                        <div class="col-xs-8">
                            <h3 class="modal-title">选择商品</h3>
                        </div>


                    </div>


                </div>
                <div class="modal-body">


                    <table  class="table table-striped">


                        <tr>
                            <td colspan="3" class="menuname"><b>商品编号</b></td>
                            <td class="menuname"><b>商品名称</b></td>
                            <td class="menuname"><b>单价</b></td>
                            <!--<td class="menuname"><b>库存</b></td>-->
                            <td class="menuname"><b>选择</b></td>
                        </tr>
                        <tbody >

                        <tr ng-repeat="item in shopdatas" >
                            <td colspan="3"><b class="product_detail_no">{{item.product_no}}</b></td>
                            <td><b>{{item.name}}</b></td>
                            <td><b>{{item.price}}</b></td>
                            <!--	<td><b>{{item.visible}}</b></td>-->
                            <td>
                                <a href="javascript:void(0);" ng-click="buyAction(item);">选择</a>
                            </td>
                        </tr>

                        </tbody>
                    </table>

                </div>
                <div class="modal-footer">


                    <div class="row">
                        <div class="col-xs-12" align=center>
                            <button class="btn btn-primary btn-o" ng-click="close()">取消</button>
                        </div>
                    </div>


                </div>
                <!--</script>-->
            </div>
            <div id="asideContent1" style="display:none;border:1px solid #dddddd;background:#fff;" class="roundrec">
                <!--<script type="text/ng-template" id="asideContent.html">-->
                <div class="modal-header" style="height:60px;">

                    <div class="col-xs-12">

                        <div class="col-xs-8">
                            <h3 class="modal-title">选择会员</h3>
                        </div>


                    </div>


                </div>
                <div class="modal-body">


                    <table ng-table="tableParamsuser" class="table table-striped">
                        <thead>
                        <tr>
                            <th style="width:40px;">
                                <nobr>序号</nobr>
                            </th>
                            <th>姓名</th>
                            <th>电话</th>
                            <th class="hidden-xs">积分</th>

                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="item in $data">
                            <td>{{item.id}}</td>
                            <td><a ng-click="getuserid(item)">{{item.nickname}}</a></td>
                            <td><a ng-click="getuserid(item)">{{item.phone}}</a></td>
                            <td class="hidden-xs">{{item.points}}</td>


                        </tr>
                        </tbody>
                    </table>


                </div>
                <div class="modal-footer">


                    <div class="row">
                        <div class="col-xs-12" align=center>
                            <button class="btn btn-primary btn-o" ng-click="close()">取消</button>
                        </div>
                    </div>


                </div>

                <!--</script>-->
            </div>

            <div id="asideContent" style="display:none;border:1px solid #dddddd;background:#fff;" class="roundrec">
                <!--<script type="text/ng-template" id="asideContent.html">-->
                <div class="modal-header" style="height:60px;">

                    <div class="col-xs-12">

                        <div class="col-xs-8">
                            <h3 class="modal-title">选择商家</h3>
                        </div>


                    </div>


                </div>
                <div class="modal-body" style="overflow:auto;" id="getshop_modal-body">

                    <table ng-table="tableParamsShop" class="table table-striped">
                        <thead>
                        <tr>
                            <th style="width:40px;">
                                <nobr>序号</nobr>
                            </th>
                            <th>编号</th>
                            <th>名称</th>
                            <th class="hidden-xs">分类</th>
                            <th class="hidden-xs">地址</th>
                            <th class="hidden-xs">评价</th>

                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="item in $data">
                            <td>{{item.id}}</td>
                            <td><a ng-click="getshop('{{item.shop_id}}')">{{item.shop_id}}</a></td>
                            <td><a ng-click="getshop('{{item.shop_id}}')">{{item.name}}</a></td>
                            <td class="hidden-xs">{{item.subtype}}</td>
                            <td class="hidden-xs">{{item.address}}</td>
                            <td class="hidden-xs">{{item.star}}</td>

                        </tr>
                        </tbody>
                    </table>


                </div>


                <div class="modal-footer">


                    <div class="row">
                        <div class="col-xs-12" align=center>
                            <button class="btn btn-primary btn-o" ng-click="close()">取消</button>
                        </div>
                    </div>


                </div>

                <!--</script>-->
            </div>


            <div id="asideContent2" style="display:none;border:1px solid #dddddd;background:#fff;" class="roundrec">
                <!--<script type="text/ng-template" id="asideContent.html">-->
                <div class="modal-header" style="height:60px;">

                    <div class="col-xs-12">

                        <div class="col-xs-8">
                            <h3 class="modal-title">选择分类</h3>
                        </div>


                    </div>


                </div>
                <div class="modal-body" style="overflow:auto;" id="gettype_modal-body">


                    <table ng-table="tableParams2" class="table">
                        <thead>
                        <tr>
                            <th style="width:40px;">
                                <nobr>序号</nobr>
                            </th>
                            <th>商家</th>
                            <th>卡券分类</th>

                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="item in $data" class="small">
                            <td style="width:40px;">{{item.id}}</td>
                            <td>{{item.shop_name}}</td>
                            <td><a ng-click="gettickettypeact('{{item.ticket_type}}')">{{item.ticket_type}}</a>
                            </td>

                        </tr>
                        </tbody>
                    </table>


                </div>


                <div class="modal-footer">


                    <div class="row">
                        <div class="col-xs-12" align=center>
                            <button class="btn btn-primary btn-o" ng-click="close()">取消</button>
                        </div>
                    </div>


                </div>


                <!--</script>-->
            </div>


            <form id="f1" class="form-register">
                <div class="title">
                    {{currTitle}}
                </div>

                <p>
                    商家编号:
                </p>
                <div class="form-group">
                    <input type="text" class="form-control" id="shop_id" name="shop_id" placeholder="商家编号"
                           ng-model="shop_id" readOnly>
                    <a class="forgot" href1="" ng-click="open('asideContent')">选择</a>
                </div>
                <p>
                    分类名称:
                </p>
                <div class="form-group">
                    <input type="text" class="form-control" id="ticket_type" name="ticket_type" placeholder="分类名称"
                           ng-model="ticket_type" readOnly>
                    <a class="forgot" href1="" ng-click="gettickettype()">选择</a>
                </div>
                <p style="display: none">
                    编号:
                </p>
                <div class="form-group">
                    <input type="text" class="form-control" id="ticket_id" style="display: none" name="ticket_id" placeholder="编号系统生成"
                           ng-model="ticket_id" readonly>
                </div>




                <p>
                    有效期起:
                </p>
                <div class="form-group">
                    <!--<input type="text" class="form-control" id="b_date" name="b_date" placeholder="有效期起" ng-model="b_date">-->

                    <span class="input-icon">
                                <input class="form-control ng-isolate-scope ng-valid-date ng-touched ng-dirty ng-valid ng-valid-required"
                                       datepicker-popup="yyyy-MM-dd" style="border-radius: 0" name="b_date" ng-model="b_date" is-open="startOpened"
                                       ng-init="startOpened = false" min-date="minDate" max-date="" placeholder="有效期起"
                                       ng-required="true" close-text="Close" required="required" id="Sdate">
                                <button type="button" class="btn btn-default fa fa-calendar"
                                        style="border: none;height:20px;position: absolute;top:2px;left:4px"
                                        ng-click="startOpen($event)"></button>
                            </span>

                </div>




                <p>
                    有效期止:
                </p>
                <div class="form-group">
                    <!--<input type="text" class="form-control" id="e_date" name="e_date" placeholder="有效期止"-->
                    <!--ng-model="e_date">-->


                    <span class="input-icon">
                                <input class="form-control ng-pristine ng-untouched ng-isolate-scope ng-invalid ng-invalid-required ng-valid-date"
                                       datepicker-popup="yyyy-MM-dd" style="border-radius: 0"  ng-model="e_date" is-open="endOpened"
                                       ng-init="endOpened = false"  name="e_date" min-date="b_date" max-date=""
                                       ng-required="true" close-text="Close" required="required" id="Gdate" placeholder="有效期止">
                                <button type="button" class="btn btn-default fa fa-calendar" ng-click="endOpen($event)"
                                        style="border: none;height:20px;position: absolute;top:2px;left:4px"></button>
                            </span>
                </div>

                <p>
                    是否有效:
                </p>
                <div class="form-group">

                    <select class1="cs-select cs-skin-slide" class="form-control" ng-model="isvalid">
                        <option value="1" selected>有效</option>
                        <option value="0">无效</option>
                    </select>

                    <input type="text" class="form-control" id="isvalid" name="isvalid" placeholder="是否有效"
                           ng-model="isvalid" style="display:none;">
                </div>

                <p>
                    抵用金额:
                </p>
                <div class="form-group">
                    <input type="text" class="form-control" id="amount" name="amount" placeholder="抵用金额"
                           ng-model="amount">
                </div>

                <p>
                抵用积分:
                </p>
                <div class="form-group">
                <input type="text" class="form-control" id="points" name="points" placeholder="抵用积分"
                ng-model="points">
                </div>

                <p>
                折扣率:
                </p>
                <div class="form-group">
                <input type="text" class="form-control" id="rate" name="rate" placeholder="折扣率"
                ng-model="rate">
                </div>

                <p>
                    抵用商品:
                </p>
                <div class="form-group">
                    <input type="text" class="form-control" id="product_no" name="product_no" placeholder="商品编号"
                           ng-model="product_no">
                    <a class="forgot" href1="" ng-click="getproducts()">选择</a>
                    <input type="text" class="form-control" id="product_qty" name="product_qty" placeholder="数量"
                           ng-model="product_qty">
                </div>




                <div class="col-xs-12" style="padding:0px;">
                    <div class="col-xs-6" style="padding:0px;">
                        <p>
                            图片:
                        </p>
                        <img id="previewimg_photo" style="width:100px;height:60px;" src="{{serviceRoot+img}}">

                        <div class="form-group" style="padding-top:5px;">


                        <span class="input-icon">
                            <input type="text" class="form-control" id="img" name="img"
                                   placeholder="图片" ng-model="img" style="display:none;">
                            <!--<i class="fa fa-picture-o"></i>-->
                            <a class="btn btn-primary btn-o" ng-click="chooseimg('img')">
                                选择
                            </a> </span>

                        </div>
                    </div>

                </div>





                <p>
                    制单人:
                </p>
                <div class="form-group">
                    <input type="text" class="form-control" id="maker" name="maker" placeholder="制单人"
                           ng-model="maker">
                </div>
                <p>
                    制单日期:
                </p>
                <div class="form-group">
                    <input type="text" class="form-control" id="make_date" name="make_date" placeholder="制单日期"
                           ng-model="make_date">
                </div>
                <p>
                    制单数量:
                </p>
                <div class="form-group">
                    <input type="text" class="form-control" id="ticket_qty" name="ticket_qty" placeholder="制单数量"
                           ng-model="ticket_qty">
                </div>

                <p style="display: none">
                    发放日期:
                </p>
                <div class="form-group">
                    <input type="text" class="form-control" id="fafang_date" name="fafang_date" placeholder="发放日期"
                           ng-model="fafang_date" style="display: none">
                </div>


                <p style="display: none">
                    属有人:
                </p>
                <div class="form-group" style="display: none">
                    <input type="text" class="form-control" id="owner" name="owner" placeholder="属有人"
                           ng-model="owner">
                    <a class="forgot" href1="" ng-click="open('asideContent1')">选择</a>
                </div>

                <p style="display: none">
                    已使用:
                </p>
                <div class="form-group" style="display: none">

                    <select class1="cs-select cs-skin-slide" ng-model="isused">
                        <option value="1" selected>是</option>
                        <option value="0">否</option>
                    </select>

                    <input type="text" class="form-control" id="isused" name="isused" placeholder="已使用"
                           ng-model="isused" style="display:none;">
                </div>
                <p style="display: none">
                    使用日期:
                </p >
                <div class="form-group" style="display: none">
                    <input type="text" class="form-control" id="use_date" name="use_date" placeholder="使用日期"
                           ng-model="use_date">
                </div>






                <p style="display: none">
                    备注:
                </p>
                <div class="form-group">

                    <div ckeditor="options" ng-model="remark" ready="onReady()"></div>
                    <textarea type="text" class="form-control" id="remark" name="remark" placeholder="备注"
                              ng-model="remark" style="height:100px;display:none;"></textarea>

                </div>


                <p>&nbsp;</p>
                <p>&nbsp;</p>


                <div class="form-actions">
                    <a ui-sref="app.wx.me.mypublish_ticket">
                        <i class="fa fa-chevron-circle-left"></i> 返回
                    </a>
                    <button type="button" id="submit" class="btn btn-primary pull-right">
                        提交 <i class="fa fa-arrow-circle-right"></i>
                    </button>
                </div>

            </form>
            <p>&nbsp;</p>
            <p>&nbsp;</p>

        </div>
        <!-- end: REGISTER BOX -->


    </div>
</div>
<!-- end: REGISTRATION -->
